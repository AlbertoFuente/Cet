"use strict";function tableDownloads(){var e=document.createElement("script");e.src="../../bower_components/table-export/tableExport.js",document.head.appendChild(e);var a=document.createElement("script");a.src="../../bower_components/table-export/jquery.base64.js",document.head.appendChild(a);var t=document.createElement("script");t.src="../../bower_components/table-export/html2canvas.js",document.head.appendChild(t);var n=document.createElement("script");n.src="../../bower_components/table-export/jspdf/jspdf.js",document.head.appendChild(n);var o=document.createElement("script");o.src="../../bower_components/table-export/jspdf/libs/base64.js",document.head.appendChild(o);var l=document.createElement("script");l.src="../../bower_components/table-export/jspdf/libs/sprintf.js",document.head.appendChild(l)}function selectedOption(e){var a=$("#cetTable");switch(e){case"json":a.tableExport({type:e,escape:"false"});break;case"xml":a.tableExport({type:e,escape:"false"});break;case"sql":a.tableExport({type:e});break;case"txt":a.tableExport({type:e,escape:"false"});break;case"csv":a.tableExport({type:e,escape:"false"});break;case"xsl":a.tableExport({type:"excel",escape:"false"});break;case"doc":a.tableExport({type:e,escape:"false"});break;case"ppt":a.tableExport({type:"powerpoint",escape:"false"});break;case"png":a.tableExport({type:e,escape:"false"});break;case"pdf":a.tableExport({type:e,pdfFontSize:"7",escape:"false"})}}function showGraphModal(e,a,t){var n=document.createElement("div");n.className="gModal";var o=document.createElement("div");o.className="gHeader";var l=document.createElement("button");l.className="closeButton mdi-content-clear",l.onclick=function(){closeModal(n)};var r=document.createElement("div");r.className="gContent",r.id="chart";var c=document.createElement("svg");switch(r.appendChild(c),o.appendChild(l),n.appendChild(o),n.appendChild(r),e){case"Bar chart":var s=[];s.push({key:"Table Bar Chart",values:[]}),$.each(a,function(e){s[0].values.push({label:a[e],value:parseInt(t[e])})}),nv.addGraph(function(){var e=nv.models.discreteBarChart().x(function(e){return e.label}).y(function(e){return e.value}).staggerLabels(!0).tooltips(!0).showValues(!0).duration(250);return d3.select("#chart svg").datum(s).call(e),nv.utils.windowResize(e.update),e});break;case"Line chart":var i=[];i.push({key:"Line Chart",values:[]}),$.each(a,function(e){i[0].values.push({area:!1,label:a[e],value:parseInt(t[e])})}),nv.addGraph(function(){var e=nv.models.lineWithFocusChart();return e.xAxis.tickFormat(d3.format(",f")),e.x2Axis.tickFormat(d3.format(",f")),e.yAxis.tickFormat(d3.format(",.2f")),e.y2Axis.tickFormat(d3.format(",.2f")),d3.select("#chart svg").datum(i).call(e),nv.utils.windowResize(e.update),e});break;case"Pie chart":var d=[];$.each(a,function(e){d.push({label:a[e],value:parseInt(t[e])})}),nv.addGraph(function(){var e=nv.models.pieChart().x(function(e){return e.label}).y(function(e){return e.value}).showLabels(!0).labelThreshold(.05).labelType("percent").donut(!0).donutRatio(.35);return d3.select("#chart svg").datum(d).transition().duration(350).call(e),e});break;case"Scatter chart":var p=[];p.push({key:"Scatter Chart",values:[]}),$.each(a,function(e){p[0].values.push({label:a[e],value:parseInt(t[e])})}),nv.addGraph(function(){var e=nv.models.scatterChart().showDistX(!0).showDistY(!0).useVoronoi(!0).color(d3.scale.category10().range()).duration(300);return e.xAxis.tickFormat(d3.format(".02f")),e.yAxis.tickFormat(d3.format(".02f")),e.tooltipContent(function(e){return"<h2>"+e+"</h2>"}),d3.select("#chart svg").datum(p).call(e),nv.utils.windowResize(e.update),e})}document.body.appendChild(n)}function prepareGraphData(e,a,t){function n(e){var a=document.createElement("label");a.className="errLabel",a.innerHTML="Impossible to construct a graph of the selected data, try another selection.",e.appendChild(a),setTimeout(function(){e.removeChild(a)},5e3)}var o=a.type,l=a.xAxis,r=a.yAxis,c=e.tableData[0].head,s=e.tableData[0].body,i=null,d=null,p=[],u=[],m={};$.each(c,function(e,a){a===l&&(i=e.slice(-1)),a===r&&(d=e.slice(-1))}),$.each(s,function(e,a){$.each(a,function(e,a){var t="td"+i,n="td"+d;t===e&&p.push(a.data),n===e&&u.push(a.data)})}),p.length>0&&p.length===u.length&&(m.sameLength=!0);var h=0,f=0,v=/^\d+$/;for(h;h<p.length;h++){if(!v.test(p[h])){m.xAxisIsNum=!1;break}m.xAxisIsNum=!0}for(f;f<u.length;f++){if(!v.test(u[f])){m.yAxisIsNum=!1;break}m.yAxisIsNum=!0}m.sameLength&&(m.xAxisIsNum!==m.yAxisIsNum?(t.parentNode.style.display="none",showGraphModal(o,p,u)):n(t))}function closeModal(e){$(e).remove()}function openModal(e,a){function t(e,a,t,n,o){var l=document.createElement("label");l.innerHTML=e,t.appendChild(l),o.id=n;for(var r=0;r<a.length;r++){var c=document.createElement("option");c.value=a[r],c.innerHTML=a[r],o.appendChild(c)}t.appendChild(o)}var n=document.createElement("div");n.id="_cetTableModal";var o=document.createElement("div");o.className="_cetTableModalHeader";var l=document.createElement("label"),r=document.createElement("button");r.className="closeButton mdi-content-clear",r.onclick=function(){closeModal(n)};var c=document.createElement("div");switch(c.className="_cetTableContent",e){case"graph":l.innerHTML="Config graph options";var s=a.tableData[0].head,i="Select graph type: ",d=document.createElement("select"),p="selectType",u=["Bar chart","Line chart","Pie chart","Scatter chart"];t(i,u,c,p,d);var m="Select X axis: ",h=document.createElement("select"),f="selectXaxis",v=[];$.each(s,function(e,a){v.push(a)}),t(m,v,c,f,h);var b="Select Y axis: ",g=document.createElement("select"),y="selectYaxis",E=[];$.each(s,function(e,a){E.push(a)}),t(b,E,c,y,g);var C=document.createElement("a");C.className="doneButton waves-effect waves-light btn",C.innerHTML="DONE",c.appendChild(C),C.onclick=function(){var e={};e.xAxis=h.value,e.yAxis=g.value,e.type=d.value,prepareGraphData(a,e,c)};break;case"downloads":tableDownloads(),l.innerHTML="Config Downloads Options";var N=document.createElement("label");N.innerHTML="Download Options: ";var w=document.createElement("select");"object"==typeof a.downloadOptions&&$.each(a.downloadOptions,function(e,a){if(a){var t=document.createElement("option");t.value=e,t.innerHTML=e,w.appendChild(t)}});var x=document.createElement("button");x.className="doneButton waves-effect waves-light btn",x.innerHTML="DOWNLOAD",x.onclick=function(){var e=w.value;selectedOption(e)},c.appendChild(N),c.appendChild(w),c.appendChild(x)}o.appendChild(r),o.appendChild(l),n.appendChild(o),n.appendChild(c),document.body.appendChild(n)}function closeMenu(e,a){e.style.display="none";var t=a.childNodes[0];t.className="normalButton mdi-navigation-menu"}function listTableOptions(e,a,t){function n(n,o,l){var r=document.createElement("li");r.className="optionsLi",r.innerHTML=o,l.appendChild(r),r.onclick=function(){openModal(n,e),closeMenu(a,t)}}var o=document.createElement("ul");o.className="optionsList";var l=null,r=null;e.listOptions.graphs&&(l="graph",r="Show graph panel",n(l,r,o)),e.listOptions.downloads&&(l="downloads",r="Show Downloads Panel",n(l,r,o)),a.appendChild(o)}function getLocalData(e){void 0!==e&&(localStorage.getItem("_tableData")?(e.tableData=JSON.parse(localStorage.getItem("_tableData")),e.tableConstructor(e)):$.ajax({url:e.localDataUrl,method:"GET",dataType:"json",success:function(a){void 0!==a&&(e.tableData=a,e.tableConstructor(e))},error:function(){throw new Error("Could not load the data inside the "+e.localDataUrl+" file")}}))}function fireBaseData(e){if(void 0!==e){var a=new Firebase(e.fireBaseUrl);a.on("value",function(a){e.tableData=a.val(),e.tableConstructor(e)},function(e){throw new Error("The read failed: "+e.code)})}}function apiRestData(){}function tableEffects(e,a,t,n,o){var l=$("."+e),r=$("."+a),c=a.slice(-1),s=$(".th"+c);switch(t){case"hover":l.attr("style","background: rgba(15, 151, 249, 0.21)"),r.attr("style","background: rgba(15, 151, 249, 0.21)"),s.attr("style","background: rgb(15, 151, 249); color: white");break;case"out":l.removeAttr("style"),r.removeAttr("style"),s.removeAttr("style");break;case"sort":for(var i=n.getElementsByClassName(a),d=[],p=[],u=!1,m=/^\d+$/,h=0;h<i.length;h++)u=!!m.test(i[h].childNodes[0].value),d.push({tr:i[h].parentNode,value:i[h].childNodes[0].value}),p.push(i[h].childNodes[0].value);"down"===o?(u?p.sort(function(e,a){return e-a}):p.reverse(),_cetTable.printNewBody(p,d,n)):(u?p.sort(function(e,a){return a-e}):p.sort(),_cetTable.printNewBody(p,d,n));var f=n.getElementsByTagName("input");$(f).change(function(){_cetTable.inputChange(this)}),$(f).hover(function(){_cetTable.mouseEffects(this,"hover")}),$(f).mouseout(function(){_cetTable.mouseEffects(this,"out")}),$(".datepicker").pickadate()}}function createTable(e){function a(a,t,n,o){switch(e.tableData[0].body[a][t].data=n,o){case 1:if(!window.localStorage)throw new Error("Your browser don't support LocalStorage!");localStorage.setItem("_tableData",JSON.stringify(e.tableData));break;case 2:if(""!==e.fireBaseUrl){var l=new Firebase(e.fireBaseUrl);l.set(e.tableData)}break;case 3:}}e.printNewBody=function(e,a,t){var n=t.childNodes[1],o=[];$(n).empty();for(var l=0;l<e.length;l++)for(var r=0;r<a.length;r++)e[l]===a[r].value&&o.push(a[r].tr);$(n).append(o)},e.mouseEffects=function(e,a){var t=e.parentNode.parentNode.className,n=e.parentNode.className;tableEffects(t,n,a)},e.inputChange=function(t){var n=t.parentNode.className,o=t.value,l=t.parentNode.parentNode.className;a(l,n,o,e.mode)},e.tableConstructor=function(e){if(void 0!==e){if(e.header){var a=document.createElement("div");a.className="tableHeader";var t=document.createElement("label");if(t.className="tableHeaderTitle",t.innerHTML=e.title,e.options){var n=document.createElement("button");n.className="normalButton mdi-navigation-menu",a.appendChild(n);var o=document.createElement("div");o.className="optionsContainer",o.style.display="none",void 0!==e.listOptions&&"object"==typeof e.listOptions&&listTableOptions(e,o,a),n.onclick=function(){var e=this.getBoundingClientRect();o.style.top=e.top+38+"px",o.style.left=e.left-164+"px","normalButton mdi-navigation-menu"===this.className?(this.className="clickedButton mdi-navigation-menu",$(document).find("optionsContainer")?(document.body.appendChild(o),o.style.display="block"):o.style.display="block"):(this.className="normalButton mdi-navigation-menu",o.style.display="none")}}a.appendChild(t),e.container.appendChild(a)}if(1===e.container.childNodes.length){var l=document.createElement("table");l.id="cetTable",l.className="striped";var r=document.createElement("tHead"),c=e.tableData.head||e.tableData[0].head;$.each(c,function(a,t){var n=document.createElement("th");n.className=a;var o=document.createElement("span");if(o.innerHTML=t,n.setAttribute("data-field",t),n.appendChild(o),e.sortable){var l=document.createElement("i");l.className="mdi-hardware-keyboard-arrow-down sortIcon",n.appendChild(l)}r.appendChild(n)}),l.appendChild(r);var s=document.createElement("tBody"),i=e.tableData.body||e.tableData[0].body;$.each(i,function(e,a){var t=document.createElement("tr");t.className=e,$.each(a,function(e,a){var n=document.createElement("td");if(n.className=e,void 0!==a.data&&void 0!==a.type)if(a.edit){var o=document.createElement("input");o.className="input_"+e,"date"===a.type?($(o).addClass("datepicker picker__input"),o.type="text",o.value=a.data,o.setAttribute("placeholder",a.data)):(o.type=a.type,o.value=a.data),n.appendChild(o)}else{var l=document.createElement("span");l.innerHTML=a.data,l.value=a.data,n.appendChild(l)}t.appendChild(n)}),s.appendChild(t)}),l.appendChild(s),e.container.appendChild(l);var d=l.getElementsByTagName("input"),p=l.getElementsByTagName("i");return $(d).change(function(){e.inputChange(this)}),$(d).hover(function(){e.mouseEffects(this,"hover")}),$(d).mouseout(function(){e.mouseEffects(this,"out")}),$(p).click(function(){var e=this.parentNode.className,a=e.slice(-1),t="td"+a,n="sort",o="mdi-hardware-keyboard-arrow-down sortIcon",r="mdi-hardware-keyboard-arrow-up sortIcon",c=l.getElementsByTagName("i"),s="down";if(this.className===o)for(var i=0;i<c.length;i++)c[i].className=r,s="up";else for(var i=0;i<c.length;i++)c[i].className=o,s="down";tableEffects(e,t,n,l,s)}),$(".datepicker").pickadate(),e.container}return!1}},void 0!==e&&(e.dataOptions.localData?""!==e.localDataUrl?(e.mode=1,getLocalData(e)):alert("You must add _cetTable.localDataUrl in config.js"):e.dataOptions.fireBase?""!==e.fireBaseUrl?(e.mode=2,fireBaseData(e)):alert("You must add _cetTable.fireBaseUrl in config.js"):e.dataOptions.apiRest&&(""!==e.apiRestUrl?(e.mode=3,apiRestData(e.apiRestUrl)):alert("You must add _cetTable.apiRestUrl in config.js")))}var imported=document.createElement("script");imported.src="../config/config.js",document.head.appendChild(imported);