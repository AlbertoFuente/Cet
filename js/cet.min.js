"use strict";function createTable(e){e.modifyData=function(t,a,n,o){switch(e.tableData[0].body[t][a].data=n,o){case 1:if(!window.localStorage)throw new Error("Your browser don't support LocalStorage!");localStorage.setItem("_tableData",JSON.stringify(e.tableData));break;case 2:if(""!==e.fireBaseUrl){var l=new Firebase(e.fireBaseUrl);l.set(e.tableData)}break;case 3:var r=new XMLHttpRequest;r.open("POST",e.apiRestPostUrl),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.send(JSON.stringify(e.tableData))}},e.printNewBody=function(e,t,a){var n=a.childNodes[1],o=[];n.innerHTML=null;for(var l=0;l<e.length;l++)for(var r=0;r<t.length;r++)e[l]===t[r].value&&o.push(t[r].tr);for(var l=0;l<o.length;l++)n.appendChild(o[l])},e.mouseEffects=function(e,t){var a=e.parentNode.parentNode.className,n=e.parentNode.className;tableEffects(a,n,t,null,null)},e.inputChange=function(t){var a=t.parentNode.className,n=t.value,o=t.parentNode.parentNode.className;e.modifyData(o,a,n,e.mode)},e.tableConstructor=function(e){if(void 0!==e){if(e.header){var t=document.createElement("div");t.className="tableHeader";var a=document.createElement("label");if(a.className="tableHeaderTitle",a.innerHTML=e.title,e.search){var n=document.createElement("div");n.className="input-field col s6 searchTable";var o=document.createElement("i");o.className="mdi-action-search prefix";var l=document.createElement("input");l.className="validate",l.type="text",l.id="icon_prefix";var r=document.createElement("label");r.setAttribute("for","icon_prefix"),n.appendChild(o),n.appendChild(l),n.appendChild(r),t.appendChild(n),l.onchange=function(){tableSearcher(l.value,e.tableData)}}if(e.options){var s=document.createElement("button");s.className="normalButton mdi-navigation-menu",t.appendChild(s);var i=document.createElement("div");i.className="optionsContainer",i.id="optionsContainer",i.style.display="none",void 0!==e.listOptions&&"object"==typeof e.listOptions&&listTableOptions(e,i,t),s.onclick=function(){var e=s.getBoundingClientRect();i.style.top=e.top+38+"px",i.style.left=e.left-164+"px","normalButton mdi-navigation-menu"===s.className?(s.className="clickedButton mdi-navigation-menu",document.getElementById("optionsContainer")?i.style.display="block":(document.body.appendChild(i),i.style.display="block")):(s.className="normalButton mdi-navigation-menu",i.style.display="none")}}t.appendChild(a),e.container.appendChild(t)}if(1===e.container.childNodes.length){var c=document.createElement("table");c.id="cetTable",c.className="striped";var d=document.createElement("tHead"),p=e.tableData.head||e.tableData[0].head;for(var u in p)if(p.hasOwnProperty(u)&&"function"!=typeof p[u]){var m=document.createElement("th");m.className=u;var h=document.createElement("span");if(h.innerHTML=p[u],h.value=p[u],m.setAttribute("data-field",p[u]),m.appendChild(h),e.sortable){var b=document.createElement("i");b.className="mdi-hardware-keyboard-arrow-down sortIcon",m.appendChild(b)}d.appendChild(m)}c.appendChild(d);var f=document.createElement("tBody"),v=e.tableData.body||e.tableData[0].body;for(var g in v)if(v.hasOwnProperty(g)&&"function"!=typeof v[g]){var y=document.createElement("tr");y.className=g;for(var N in v[g]){var E=document.createElement("td");if(E.className=N,void 0!==v[g][N].data&&void 0!==v[g][N].type)if(v[g][N].edit){var C=document.createElement("input");e.tooltips?(C.className="input_edit tooltipped",C.setAttribute("data-position","bottom"),C.setAttribute("data-delay","30"),C.setAttribute("data-tooltip","Edit field: "+v[g][N].data)):C.className="input_edit","date"===v[g][N].type?(C.className=C.className+" datepicker picker__input",C.type="text",C.value=v[g][N].data,C.setAttribute("placeholder",v[g][N].data)):(C.type=v[g][N].type,C.value=v[g][N].data),E.appendChild(C)}else{var w=document.createElement("span");if(w.className="noEditableField",w.innerHTML=v[g][N].data,w.value=v[g][N].data,e.tooltips){w.className=w.className+" tooltipped",w.setAttribute("data-position","bottom"),w.setAttribute("data-delay","30"),E.appendChild(w);var T=w.parentNode.className,x=T.slice(-1),D="th"+x,B=d.getElementsByClassName(D)[0].innerText;w.setAttribute("data-tooltip",B+": "+v[g][N].data)}else E.appendChild(w)}y.appendChild(E)}f.appendChild(y)}c.appendChild(f),e.container.appendChild(c);for(var k=c.getElementsByTagName("input"),_=c.getElementsByTagName("i"),A=c.getElementsByTagName("span"),M=0;M<k.length;M++)!function(t){k[t].onchange=function(){e.inputChange(k[t])},k[t].onmouseover=function(){e.mouseEffects(k[t],"hover")},k[t].onmouseout=function(){e.mouseEffects(k[t],"out")}}(M);for(var M=0;M<A.length;M++)!function(t){A[t].onmouseover=function(){e.mouseEffects(A[t],"hover")},A[t].onmouseout=function(){e.mouseEffects(A[t],"out")}}(M);for(var M=0;M<_.length;M++)!function(e){_[e].onclick=function(){var t=_[e].parentNode.className,a=t.slice(-1),n="td"+a,o="sort",l="mdi-hardware-keyboard-arrow-down sortIcon",r="mdi-hardware-keyboard-arrow-up sortIcon",s=c.getElementsByTagName("i"),i="down";if(_[e].className===l)for(var d=0;d<s.length;d++)s[d].className=r,i="up";else for(var p=0;p<s.length;p++)s[p].className=l,i="down";tableEffects(t,n,o,c,i)}}(M);return $(".datepicker").pickadate(),e.container}return!1}},void 0!==e&&(e.dataOptions.localData?""!==e.localDataUrl?(e.mode=1,getLocalData(e)):alert("You must add _cetTable.localDataUrl in config.js"):e.dataOptions.fireBase?""!==e.fireBaseUrl?(e.mode=2,fireBaseData(e)):alert("You must add _cetTable.fireBaseUrl in config.js"):e.dataOptions.apiRest&&(""!==e.apiRestUrl?(e.mode=3,apiRestData(e.apiRestGetUrl)):alert("You must add _cetTable.apiRestUrl in config.js")))}function getLocalData(e){if(void 0!==e)if(localStorage.getItem("_tableData"))e.tableData=JSON.parse(localStorage.getItem("_tableData")),e.tableConstructor(e);else{var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===t.readyState){if(200!==t.status)throw new Error("Could not load the data inside the "+e.localDataUrl+" file");e.tableData=JSON.parse(t.responseText),e.tableConstructor(e)}},t.open("GET",e.localDataUrl,!1),t.send()}}function fireBaseData(e){if(void 0!==e){var t=new Firebase(e.fireBaseUrl);t.on("value",function(t){e.tableData=t.val(),e.tableConstructor(e)},function(e){throw new Error("The read failed: "+e.code)})}}function apiRestData(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===t.readyState){if(200!==t.status)throw new Error("Could not load the data inside the "+e+" file");cet.tableData=JSON.parse(t.responseText),cet.tableConstructor(cet)}},t.open("GET",e,!1),t.send()}function tableEffects(e,t,a,n,o){var l=document.getElementsByClassName(e),r=document.getElementsByClassName(t),s=t.slice(-1),i="th"+s,c=document.getElementsByClassName(i);switch(a){case"hover":for(var d=0;d<c.length;d++)c[d].setAttribute("style","background: rgb(15, 151, 249); color: white");for(var d=0;d<l.length;d++)l[d].setAttribute("style","background: rgba(15, 151, 249, 0.21)");for(var d=0;d<r.length;d++)r[d].setAttribute("style","background: rgba(15, 151, 249, 0.21)");break;case"out":for(var d=0;d<c.length;d++)c[d].hasAttribute("style")&&c[d].removeAttribute("style");for(var d=0;d<l.length;d++)l[d].hasAttribute("style")&&l[d].removeAttribute("style");for(var d=0;d<r.length;d++)r[d].hasAttribute("style")&&r[d].removeAttribute("style");break;case"sort":for(var p=n.getElementsByClassName(t),u=[],m=[],h=!1,b=/^\d+$/,d=0;d<p.length;d++)h=!!b.test(p[d].childNodes[0].value),u.push({tr:p[d].parentNode,value:p[d].childNodes[0].value}),m.push(p[d].childNodes[0].value);"down"===o?(h?m.sort(function(e,t){return e-t}):m.reverse(),_cetTable.printNewBody(m,u,n)):(h?m.sort(function(e,t){return t-e}):m.sort(),_cetTable.printNewBody(m,u,n));for(var f=n.getElementsByTagName("input"),v=n.getElementsByTagName("span"),d=0;d<f.length;d++)!function(e){f[e].onchange=function(){_cetTable.inputChange(f[e])},f[e].onmouseover=function(){_cetTable.mouseEffects(f[e],"hover")},f[e].onmouseout=function(){_cetTable.mouseEffects(f[e],"out")}}(d);for(var d=0;d<v.length;d++)!function(e){v[e].onmouseover=function(){_cetTable.mouseEffects(v[e],"hover")},v[e].onmouseout=function(){_cetTable.mouseEffects(v[e],"out")}}(d);$(".datepicker").pickadate()}}function closeModal(e){var t=document.getElementById(e.id);t.remove()}function openModal(e,t){var a=document.createElement("div");a.id="_cetTableModal";var n=document.createElement("div");n.className="_cetTableModalHeader";var o=document.createElement("label"),l=document.createElement("button");l.className="closeButton mdi-content-clear",l.onclick=function(){closeModal(a)};var r=document.createElement("div");switch(r.className="_cetTableContent",e){case"graph":o.innerHTML="Config graph options";var s=function(e,t,a,n,o){var l=document.createElement("label");l.innerHTML=e,a.appendChild(l),o.id=n;for(var r=0;r<t.length;r++){var s=document.createElement("option");s.value=t[r],s.innerHTML=t[r],o.appendChild(s)}a.appendChild(o)},i=t.tableData[0].head,c="Select graph type: ",d=document.createElement("select"),p="selectType",u=["Bar chart","Line chart","Pie chart","Polar Area chart"];s(c,u,r,p,d);var m="Select X axis: ",h=document.createElement("select"),b="selectXaxis",f=[];for(var v in i)f.push(i[v]);s(m,f,r,b,h);var g="Select Y axis: ",y=document.createElement("select"),N="selectYaxis",E=[];for(var v in i)E.push(i[v]);s(g,E,r,N,y);var C=document.createElement("a");C.className="doneButton waves-effect waves-light btn",C.innerHTML="DONE",r.appendChild(C),C.onclick=function(){var e={};e.xAxis=h.value,e.yAxis=y.value,e.type=d.value,prepareGraphData(t,e,r)};break;case"downloads":tableDownloads(),o.innerHTML="Config Downloads Options";var w=document.createElement("label");w.innerHTML="Download Options: ";var T=document.createElement("select");if("object"==typeof t.downloadOptions)for(var v in t.downloadOptions)if(t.downloadOptions[v]){var x=document.createElement("option");x.value=v,x.innerHTML=v,T.appendChild(x)}var D=document.createElement("button");D.className="doneButton waves-effect waves-light btn",D.innerHTML="DOWNLOAD",D.onclick=function(){var e=T.value;selectedOption(e)},r.appendChild(w),r.appendChild(T),r.appendChild(D)}n.appendChild(l),n.appendChild(o),a.appendChild(n),a.appendChild(r),document.body.appendChild(a)}function closeMenu(e,t){e.style.display="none";var a=t.childNodes[0];a.className="normalButton mdi-navigation-menu"}function listTableOptions(e,t,a){var n=document.createElement("ul");n.className="optionsList";var o=null,l=null,r=function(n,o,l){var r=document.createElement("li");r.className="optionsLi",r.innerHTML=o,l.appendChild(r),r.onclick=function(){openModal(n,e),closeMenu(t,a)}};e.listOptions.graphs&&(o="graph",l="Show graph panel",r(o,l,n)),e.listOptions.downloads&&(o="downloads",l="Show Downloads Panel",r(o,l,n)),t.appendChild(n)}function showModal(){var e=document.createElement("div");e.className="gModal",e.id="gModal";var t=document.createElement("div");t.className="gHeader";var a=document.createElement("button");a.className="closeButton mdi-content-clear",a.onclick=function(){closeModal(e)};var n=document.createElement("canvas");n.className="gContent",n.id="chart",n.width="700",n.height="350",t.appendChild(a),e.appendChild(t),e.appendChild(n),document.body.appendChild(e)}function showGraph(e,t,a){var n=function(e){var t=["rgba(244, 67, 54, 0.5)","rgba(233, 30, 99, 0.5)","rgba(156, 39, 176, 0.5)","rgba(103, 58, 183, 0.5)","rgba(63, 81, 181, 0.5)","rgba(33, 150, 143, 0.5)","rgba(3, 169, 244, 0.5)","rgba(0, 188, 212, 0.5)","rgba(0, 150, 136, 0.5)","rgba(76, 175, 80, 0.5)","rgba(139, 195, 74, 0.5)","rgba(205, 220, 57, 0.5)","rgba(255, 235, 59, 0.5)","rgba(255, 193, 7, 0.5)","rgba(255, 152, 0, 0.5)","rgba(255, 87, 34, 0.5)","rgba(121, 85, 72, 0.5)"];return e>t.length?t[Math.floor(Math.random()*t.length)]:t[e]};switch(e){case"Bar chart":var o={labels:[],datasets:[{data:[],label:"title A",fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)"}]};for(var l in t)o.labels.push(t[l]);for(var l in a)o.datasets[0].data.push(parseInt(a[l]));var r=document.getElementById("chart").getContext("2d"),s=new Chart(r).Bar(o);for(var l in t)s.datasets[0].bars[l].fillColor=n(l),s.datasets[0].bars[l].strokeColor=n(l);s.update();break;case"Line chart":var i={labels:[],datasets:[{data:[],label:"title A",fillColor:"rgba(244, 67, 54, 0.5)",strokeColor:"rgba(244, 67, 54, 0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)"}]};for(var l in t)i.labels.push(t[l]);for(var l in a)i.datasets[0].data.push(parseInt(a[l]));{var c=document.getElementById("chart").getContext("2d");new Chart(c).Line(i)}break;case"Pie chart":var d=[];for(var l in t)d.push({label:t[l],value:parseInt(a[l]),color:n(l),highlight:n(l)});{var p=document.getElementById("chart").getContext("2d");new Chart(p).Doughnut(d)}break;case"Polar Area chart":var u=[];for(var l in t)u.push({label:t[l],value:parseInt(a[l]),color:n(l),highlight:n(l)});{var m=document.getElementById("chart").getContext("2d");new Chart(m).PolarArea(u)}}}function prepareGraphData(e,t,a){var n=t.type,o=t.xAxis,l=t.yAxis,r=e.tableData[0].head,s=e.tableData[0].body,i=null,c=null,d=[],p=[],u={};for(var m in r)r[m]===o&&(i=m.slice(-1)),r[m]===l&&(c=m.slice(-1));for(var m in s)for(var h in s[m]){var b="td"+i,f="td"+c;b===h&&d.push(s[m][h].data),f===h&&p.push(s[m][h].data)}d.length>0&&d.length===p.length&&(u.sameLength=!0);for(var v=/^\d+$/,g=0;g<d.length;g++){if(!v.test(d[g])){u.xAxisIsNum=!1;break}u.xAxisIsNum=!0}for(var y=0;y<p.length;y++){if(!v.test(p[y])){u.yAxisIsNum=!1;break}u.yAxisIsNum=!0}var N=function(e){var t=document.createElement("label");t.className="errLabel",t.innerHTML="Impossible to construct a graph of the selected data, try another selection.",e.appendChild(t),setTimeout(function(){e.removeChild(t)},5e3)};u.sameLength&&(u.xAxisIsNum!==u.yAxisIsNum?(a.parentNode.style.display="none",showModal(),u.xAxisIsNum?showGraph(n,p,d):showGraph(n,d,p)):N(a))}function tableDownloads(){var e=document.createElement("script");e.src="../../bower_components/table-export/tableExport.js",document.head.appendChild(e);var t=document.createElement("script");t.src="../../bower_components/table-export/jquery.base64.js",document.head.appendChild(t);var a=document.createElement("script");a.src="../../bower_components/table-export/html2canvas.js",document.head.appendChild(a);var n=document.createElement("script");n.src="../../bower_components/table-export/jspdf/jspdf.js",document.head.appendChild(n);var o=document.createElement("script");o.src="../../bower_components/table-export/jspdf/libs/base64.js",document.head.appendChild(o);var l=document.createElement("script");l.src="../../bower_components/table-export/jspdf/libs/sprintf.js",document.head.appendChild(l)}function selectedOption(e){var t=$("#cetTable");switch(e){case"json":t.tableExport({type:e,escape:"false"});break;case"xml":t.tableExport({type:e,escape:"false"});break;case"sql":t.tableExport({type:e});break;case"txt":t.tableExport({type:e,escape:"false"});break;case"csv":t.tableExport({type:e,escape:"false"});break;case"xsl":t.tableExport({type:"excel",escape:"false"});break;case"doc":t.tableExport({type:e,escape:"false"});break;case"ppt":t.tableExport({type:"powerpoint",escape:"false"});break;case"png":t.tableExport({type:e,escape:"false"});break;case"pdf":t.tableExport({type:e,pdfFontSize:"7",escape:"false"})}}function tableSearcher(e,t){var a={};a.defaultData=t[0].body,a.newData=[];var n=function(e){var t=document.getElementById("cetTable"),a=t.childNodes[1];console.log(e);for(var n=0;n<e.length;n++)for(var o in a.childNodes)e[n].tr!==a.childNodes[o].className?"object"==typeof a.childNodes[o]&&(a.childNodes[o].hasAttribute("style")||(a.childNodes[o].style.opacity="0.3",a.childNodes[o].style.filter="alpha(opacity=30)")):(a.childNodes[o].style.opacity="1",a.childNodes[o].style.filter="alpha(opacity=100)")},o=function(){var e=document.getElementById("cetTable"),t=e.childNodes[1];for(var a in t.childNodes)"object"==typeof t.childNodes[a]&&t.childNodes[a].removeAttribute("style")},l=e.toLowerCase();if(""!=e){for(var r in a.defaultData)for(var s in a.defaultData[r]){var i=a.defaultData[r][s].data.toLowerCase();-1!=i.search(l)&&a.newData.push({tr:r,tds:a.defaultData[r]})}o(),n(a.newData)}else o(),n(a.defaultData)}var _cetTable={};_cetTable.header=!0,_cetTable.title="Table Title",_cetTable.options=!0,_cetTable.listOptions={graphs:!0,downloads:!0},_cetTable.tooltips=!0,_cetTable.downloadOptions={json:!0,xml:!0,sql:!0,txt:!0,csv:!0,xsl:!0,doc:!0,ppt:!0,png:!0,pdf:!0},_cetTable.search=!0,_cetTable.dataOptions={localData:!0,fireBase:!1,apiRest:!1},_cetTable.localDataUrl="localData/tableData.json",_cetTable.fireBaseUrl="",_cetTable.apiRestGetUrl="",_cetTable.apiRestPostUrl="",_cetTable.effects=!0,_cetTable.sortable=!0,_cetTable.container=document.getElementById("tableContainer"),createTable(_cetTable);