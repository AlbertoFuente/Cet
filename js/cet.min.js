"use strict";function createTable(e){e.modifyData=function(t,a,n,o){switch(e.tableData[0].body[t][a].data=n,o){case 1:if(!window.localStorage)throw new Error("Your browser don't support LocalStorage!");localStorage.setItem("_tableData",JSON.stringify(e.tableData));break;case 2:if(""!==e.fireBaseUrl){var l=new Firebase(e.fireBaseUrl);l.set(e.tableData)}break;case 3:}},e.printNewBody=function(e,t,a){var n=a.childNodes[1],o=[];n.innerHTML=null;for(var l=0;l<e.length;l++)for(var r=0;r<t.length;r++)e[l]===t[r].value&&o.push(t[r].tr);for(var l=0;l<o.length;l++)n.appendChild(o[l])},e.mouseEffects=function(e,t){var a=e.parentNode.parentNode.className,n=e.parentNode.className;tableEffects(a,n,t)},e.inputChange=function(t){var a=t.parentNode.className,n=t.value,o=t.parentNode.parentNode.className;e.modifyData(o,a,n,e.mode)},e.tableConstructor=function(e){if(void 0!==e){if(e.header){var t=document.createElement("div");t.className="tableHeader";var a=document.createElement("label");if(a.className="tableHeaderTitle",a.innerHTML=e.title,e.options){var n=document.createElement("button");n.className="normalButton mdi-navigation-menu",t.appendChild(n);var o=document.createElement("div");o.className="optionsContainer",o.id="optionsContainer",o.style.display="none",void 0!==e.listOptions&&"object"==typeof e.listOptions&&listTableOptions(e,o,t),n.onclick=function(){var e=n.getBoundingClientRect();o.style.top=e.top+38+"px",o.style.left=e.left-164+"px","normalButton mdi-navigation-menu"===n.className?(n.className="clickedButton mdi-navigation-menu",document.getElementById("optionsContainer")?o.style.display="block":(document.body.appendChild(o),o.style.display="block")):(n.className="normalButton mdi-navigation-menu",o.style.display="none")}}t.appendChild(a),e.container.appendChild(t)}if(1===e.container.childNodes.length){var l=document.createElement("table");l.id="cetTable",l.className="striped";var r=document.createElement("tHead"),s=e.tableData.head||e.tableData[0].head;for(var c in s)if(s.hasOwnProperty(c)&&"function"!=typeof s[c]){var i=document.createElement("th");i.className=c;var d=document.createElement("span");if(d.innerHTML=s[c],d.value=s[c],i.setAttribute("data-field",s[c]),i.appendChild(d),e.sortable){var p=document.createElement("i");p.className="mdi-hardware-keyboard-arrow-down sortIcon",i.appendChild(p)}r.appendChild(i)}l.appendChild(r);var u=document.createElement("tBody"),m=e.tableData.body||e.tableData[0].body;for(var f in m)if(m.hasOwnProperty(f)&&"function"!=typeof m[f]){var h=document.createElement("tr");h.className=f;for(var v in m[f]){var b=document.createElement("td");if(b.className=v,void 0!==m[f][v].data&&void 0!==m[f][v].type)if(m[f][v].edit){var g=document.createElement("input");e.tooltips?(g.className="input_edit tooltipped",g.setAttribute("data-position","bottom"),g.setAttribute("data-delay","30"),g.setAttribute("data-tooltip","Edit field: "+m[f][v].data)):g.className="input_edit","date"===m[f][v].type?(g.className=g.className+" datepicker picker__input",g.type="text",g.value=m[f][v].data,g.setAttribute("placeholder",m[f][v].data)):(g.type=m[f][v].type,g.value=m[f][v].data),b.appendChild(g)}else{var y=document.createElement("span");if(y.className="noEditableField",y.innerHTML=m[f][v].data,y.value=m[f][v].data,e.tooltips){y.className=y.className+" tooltipped",y.setAttribute("data-position","bottom"),y.setAttribute("data-delay","30"),b.appendChild(y);var E=y.parentNode.className,N=E.slice(-1),w="th"+N,C=r.getElementsByClassName(w)[0].innerText;y.setAttribute("data-tooltip",C+": "+m[f][v].data)}else b.appendChild(y)}h.appendChild(b)}u.appendChild(h)}l.appendChild(u),e.container.appendChild(l);for(var T=l.getElementsByTagName("input"),x=l.getElementsByTagName("i"),k=l.getElementsByTagName("span"),D=0;D<T.length;D++)!function(t){T[t].onchange=function(){e.inputChange(T[t])},T[t].onmouseover=function(){e.mouseEffects(T[t],"hover")},T[t].onmouseout=function(){e.mouseEffects(T[t],"out")}}(D);for(var D=0;D<k.length;D++)!function(t){k[t].onmouseover=function(){e.mouseEffects(k[t],"hover")},k[t].onmouseout=function(){e.mouseEffects(k[t],"out")}}(D);for(var D=0;D<x.length;D++)!function(e){x[e].onclick=function(){var t=x[e].parentNode.className,a=t.slice(-1),n="td"+a,o="sort",r="mdi-hardware-keyboard-arrow-down sortIcon",s="mdi-hardware-keyboard-arrow-up sortIcon",c=l.getElementsByTagName("i"),i="down";if(x[e].className===r)for(var d=0;d<c.length;d++)c[d].className=s,i="up";else for(var p=0;p<c.length;p++)c[p].className=r,i="down";tableEffects(t,n,o,l,i)}}(D);return $(".datepicker").pickadate(),e.container}return!1}},void 0!==e&&(e.dataOptions.localData?""!==e.localDataUrl?(e.mode=1,getLocalData(e)):alert("You must add _cetTable.localDataUrl in config.js"):e.dataOptions.fireBase?""!==e.fireBaseUrl?(e.mode=2,fireBaseData(e)):alert("You must add _cetTable.fireBaseUrl in config.js"):e.dataOptions.apiRest&&(""!==e.apiRestUrl?(e.mode=3,apiRestData(e.apiRestUrl)):alert("You must add _cetTable.apiRestUrl in config.js")))}function getLocalData(e){void 0!==e&&(localStorage.getItem("_tableData")?(e.tableData=JSON.parse(localStorage.getItem("_tableData")),e.tableConstructor(e)):$.ajax({url:e.localDataUrl,method:"GET",dataType:"json",success:function(t){void 0!==t&&(e.tableData=t,e.tableConstructor(e))},error:function(){throw new Error("Could not load the data inside the "+e.localDataUrl+" file")}}))}function fireBaseData(e){if(void 0!==e){var t=new Firebase(e.fireBaseUrl);t.on("value",function(t){e.tableData=t.val(),e.tableConstructor(e)},function(e){throw new Error("The read failed: "+e.code)})}}function apiRestData(){}function tableEffects(e,t,a,n,o){var l=$("."+e),r=$("."+t),s=t.slice(-1),c=$(".th"+s);switch(a){case"hover":l.attr("style","background: rgba(15, 151, 249, 0.21)"),r.attr("style","background: rgba(15, 151, 249, 0.21)"),c.attr("style","background: rgb(15, 151, 249); color: white");break;case"out":l.removeAttr("style"),r.removeAttr("style"),c.removeAttr("style");break;case"sort":for(var i=n.getElementsByClassName(t),d=[],p=[],u=!1,m=/^\d+$/,f=0;f<i.length;f++)u=!!m.test(i[f].childNodes[0].value),d.push({tr:i[f].parentNode,value:i[f].childNodes[0].value}),p.push(i[f].childNodes[0].value);"down"===o?(u?p.sort(function(e,t){return e-t}):p.reverse(),_cetTable.printNewBody(p,d,n)):(u?p.sort(function(e,t){return t-e}):p.sort(),_cetTable.printNewBody(p,d,n));for(var h=n.getElementsByTagName("input"),v=n.getElementsByTagName("span"),f=0;f<h.length;f++)!function(e){h[e].onchange=function(){_cetTable.inputChange(h[e])},h[e].onmouseover=function(){_cetTable.mouseEffects(h[e],"hover")},h[e].onmouseout=function(){_cetTable.mouseEffects(h[e],"out")}}(f);for(var f=0;f<v.length;f++)!function(e){v[e].onmouseover=function(){_cetTable.mouseEffects(v[e],"hover")},v[e].onmouseout=function(){_cetTable.mouseEffects(v[e],"out")}}(f);$(".datepicker").pickadate()}}function closeModal(e){var t=document.getElementById(e.id);t.remove()}function openModal(e,t){var a=document.createElement("div");a.id="_cetTableModal";var n=document.createElement("div");n.className="_cetTableModalHeader";var o=document.createElement("label"),l=document.createElement("button");l.className="closeButton mdi-content-clear",l.onclick=function(){closeModal(a)};var r=document.createElement("div");switch(r.className="_cetTableContent",e){case"graph":o.innerHTML="Config graph options";var s=function(e,t,a,n,o){var l=document.createElement("label");l.innerHTML=e,a.appendChild(l),o.id=n;for(var r=0;r<t.length;r++){var s=document.createElement("option");s.value=t[r],s.innerHTML=t[r],o.appendChild(s)}a.appendChild(o)},c=t.tableData[0].head,i="Select graph type: ",d=document.createElement("select"),p="selectType",u=["Bar chart","Line chart","Pie chart","Scatter chart"];s(i,u,r,p,d);var m="Select X axis: ",f=document.createElement("select"),h="selectXaxis",v=[];for(var b in c)v.push(c[b]);s(m,v,r,h,f);var g="Select Y axis: ",y=document.createElement("select"),E="selectYaxis",N=[];for(var b in c)N.push(c[b]);s(g,N,r,E,y);var w=document.createElement("a");w.className="doneButton waves-effect waves-light btn",w.innerHTML="DONE",r.appendChild(w),w.onclick=function(){var e={};e.xAxis=f.value,e.yAxis=y.value,e.type=d.value,prepareGraphData(t,e,r)};break;case"downloads":tableDownloads(),o.innerHTML="Config Downloads Options";var C=document.createElement("label");C.innerHTML="Download Options: ";var T=document.createElement("select");if("object"==typeof t.downloadOptions)for(var b in t.downloadOptions)if(t.downloadOptions[b]){var x=document.createElement("option");x.value=b,x.innerHTML=b,T.appendChild(x)}var k=document.createElement("button");k.className="doneButton waves-effect waves-light btn",k.innerHTML="DOWNLOAD",k.onclick=function(){var e=T.value;selectedOption(e)},r.appendChild(C),r.appendChild(T),r.appendChild(k)}n.appendChild(l),n.appendChild(o),a.appendChild(n),a.appendChild(r),document.body.appendChild(a)}function closeMenu(e,t){e.style.display="none";var a=t.childNodes[0];a.className="normalButton mdi-navigation-menu"}function listTableOptions(e,t,a){var n=document.createElement("ul");n.className="optionsList";var o=null,l=null,r=function(n,o,l){var r=document.createElement("li");r.className="optionsLi",r.innerHTML=o,l.appendChild(r),r.onclick=function(){openModal(n,e),closeMenu(t,a)}};e.listOptions.graphs&&(o="graph",l="Show graph panel",r(o,l,n)),e.listOptions.downloads&&(o="downloads",l="Show Downloads Panel",r(o,l,n)),t.appendChild(n)}function showModal(){var e=document.createElement("div");e.className="gModal";var t=document.createElement("div");t.className="gHeader";var a=document.createElement("button");a.className="closeButton mdi-content-clear",a.onclick=function(){closeModal(e)};var n=document.createElement("div");n.className="gContent",n.id="chart";var o=document.createElement("svg");n.appendChild(o),t.appendChild(a),e.appendChild(t),e.appendChild(n),document.body.appendChild(e)}function showGraph(e,t,a){switch(e){case"Bar chart":var n=[];n.push({key:"Table Bar Chart",values:[]}),$.each(t,function(e){n[0].values.push({label:t[e],value:parseInt(a[e])})}),nv.addGraph(function(){var e=nv.models.discreteBarChart().x(function(e){return e.label}).y(function(e){return e.value}).staggerLabels(!0).tooltips(!0).showValues(!0).duration(250);return d3.select("#chart svg").datum(n).call(e),nv.utils.windowResize(e.update),e});break;case"Line chart":var o=[];o.push({key:"Line Chart",values:[]}),$.each(t,function(e){o[0].values.push({area:!1,label:t[e],value:parseInt(a[e])})}),nv.addGraph(function(){var e=nv.models.lineWithFocusChart();return e.xAxis.tickFormat(d3.format(",f")),e.x2Axis.tickFormat(d3.format(",f")),e.yAxis.tickFormat(d3.format(",.2f")),e.y2Axis.tickFormat(d3.format(",.2f")),d3.select("#chart svg").datum(o).call(e),nv.utils.windowResize(e.update),e});break;case"Pie chart":var l=[];$.each(t,function(e){l.push({label:t[e],value:parseInt(a[e])})}),nv.addGraph(function(){var e=nv.models.pieChart().x(function(e){return e.label}).y(function(e){return e.value}).showLabels(!0).labelThreshold(.05).labelType("percent").donut(!0).donutRatio(.35);return d3.select("#chart svg").datum(l).transition().duration(350).call(e),e});break;case"Scatter chart":var r=[];r.push({key:"Scatter Chart",values:[]}),$.each(t,function(e){r[0].values.push({label:t[e],value:parseInt(a[e])})}),nv.addGraph(function(){var e=nv.models.scatterChart().showDistX(!0).showDistY(!0).useVoronoi(!0).color(d3.scale.category10().range()).duration(300);return e.xAxis.tickFormat(d3.format(".02f")),e.yAxis.tickFormat(d3.format(".02f")),e.tooltipContent(function(e){return"<h2>"+e+"</h2>"}),d3.select("#chart svg").datum(r).call(e),nv.utils.windowResize(e.update),e})}}function prepareGraphData(e,t,a){var n=t.type,o=t.xAxis,l=t.yAxis,r=e.tableData[0].head,s=e.tableData[0].body,c=null,i=null,d=[],p=[],u={};for(var m in r)r[m]===o&&(c=m.slice(-1)),r[m]===l&&(i=m.slice(-1));for(var m in s)for(var f in s[m]){var h="td"+c,v="td"+i;h===f&&d.push(s[m][f].data),v===f&&p.push(s[m][f].data)}d.length>0&&d.length===p.length&&(u.sameLength=!0);for(var b=/^\d+$/,g=0;g<d.length;g++){if(!b.test(d[g])){u.xAxisIsNum=!1;break}u.xAxisIsNum=!0}for(var y=0;y<p.length;y++){if(!b.test(p[y])){u.yAxisIsNum=!1;break}u.yAxisIsNum=!0}var E=function(e){var t=document.createElement("label");t.className="errLabel",t.innerHTML="Impossible to construct a graph of the selected data, try another selection.",e.appendChild(t),setTimeout(function(){e.removeChild(t)},5e3)};u.sameLength&&(u.xAxisIsNum!==u.yAxisIsNum?(a.parentNode.style.display="none",showModal(),showGraph(n,d,p)):E(a))}function tableDownloads(){var e=document.createElement("script");e.src="../../bower_components/table-export/tableExport.js",document.head.appendChild(e);var t=document.createElement("script");t.src="../../bower_components/table-export/jquery.base64.js",document.head.appendChild(t);var a=document.createElement("script");a.src="../../bower_components/table-export/html2canvas.js",document.head.appendChild(a);var n=document.createElement("script");n.src="../../bower_components/table-export/jspdf/jspdf.js",document.head.appendChild(n);var o=document.createElement("script");o.src="../../bower_components/table-export/jspdf/libs/base64.js",document.head.appendChild(o);var l=document.createElement("script");l.src="../../bower_components/table-export/jspdf/libs/sprintf.js",document.head.appendChild(l)}function selectedOption(e){var t=$("#cetTable");switch(e){case"json":t.tableExport({type:e,escape:"false"});break;case"xml":t.tableExport({type:e,escape:"false"});break;case"sql":t.tableExport({type:e});break;case"txt":t.tableExport({type:e,escape:"false"});break;case"csv":t.tableExport({type:e,escape:"false"});break;case"xsl":t.tableExport({type:"excel",escape:"false"});break;case"doc":t.tableExport({type:e,escape:"false"});break;case"ppt":t.tableExport({type:"powerpoint",escape:"false"});break;case"png":t.tableExport({type:e,escape:"false"});break;case"pdf":t.tableExport({type:e,pdfFontSize:"7",escape:"false"})}}var _cetTable={};_cetTable.header=!0,_cetTable.title="Table Title",_cetTable.options=!0,_cetTable.listOptions={graphs:!0,downloads:!0},_cetTable.tooltips=!0,_cetTable.downloadOptions={json:!0,xml:!0,sql:!0,txt:!0,csv:!0,xsl:!0,doc:!0,ppt:!0,png:!0,pdf:!0},_cetTable.dataOptions={localData:!0,fireBase:!1,apiRest:!1},_cetTable.localDataUrl="localData/tableData.json",_cetTable.fireBaseUrl="",_cetTable.apiRestUrl="",_cetTable.effects=!0,_cetTable.sortable=!0,_cetTable.container=document.getElementById("tableContainer"),createTable(_cetTable);